<template>
  <div class="site-work">
    <div class="tab-search mt-2 mb-2">
      <app-search @on-query="queryChartInfo" :params="null"></app-search>
    </div>
    <!-- <div v-if="!paramsList.length" class="tab-chart flex-center">
      <span class="no-data">当前站点类型未添加工况要素</span>
    </div> -->

    <div class="tab-chart">
      <base-work :data="chart.data" :config="[]" style="flex: 1" :key="chart.key"></base-work>
    </div>
  </div>
</template>

<script>
  import {generateUUID} from '@/utils'
  import {getDeviceElement, getDeviceChartData,queryRealDataByCusno} from '@/api/deviceBase'
  import appSearch from '@/common/Search.vue'

  export default {
    props: ['device'],
    components: {
      appSearch
    },
    data() {
      return {
        paramsList: [],
        chart: {
          rainRadio: 0,
          data: [],
          config: null,
          key: generateUUID(),
        },
        query: {}
      }
    },
    methods: {
      queryDeviceElement() {
        let self = this
        let params = {
          deviceid: this.device.id,
          eleType: "2"
        }
        getDeviceElement(params).then(res => {
          var rs = res.data
          if (rs) {
            var typeArr = []
            rs.forEach((item, index) => {
              var temp = {}
              var subTemp = []
              var flag = false
              if (item.config && item.config != "{}") {
                item.config = JSON.parse(item.config)
              } else {
                item.config = null
              }
              if (index == 0) {
                temp['name'] = item.vueTypeName
                temp['type'] = item.vueType
                temp['icon'] = item.icon
                subTemp.push(item)
                temp['config'] = subTemp
                typeArr.push(temp)
              } else {
                typeArr.forEach(d => {
                  if (d.type == item.vueType) {
                    flag = true
                    d.config.push(item)
                  }
                })
                if (!flag) {
                  temp['name'] = item.vueTypeName
                  temp['type'] = item.vueType
                  temp['icon'] = item.icon
                  subTemp.push(item)
                  temp['config'] = subTemp
                  typeArr.push(temp)
                }
              }
            })
            this.paramsList = typeArr
            this.currentParams = typeArr[0]
          }
        })
      },
      //查询图表
      queryChartInfo(query) {
        Object.assign(this.query, query)
        this.queryChartData()
      },

      // 获取图表数据
      queryChartData() {
        // let params = Object.assign({}, this.query)
        let q = {
          timeVal:5,
          timeUnitStr:"minutes",
          startDate:this.query.stm,
          endDate:this.query.etm,
          cusno:this.device.cusno,
        }
        // params.displayColumns = []
        // params.timeVal = 5;
        // params.timeUnitStr = "minutes";
        // params.cusno = this.device.cusno;
        // params.startDate = this.query.stm;
        // params.endDate = this.query.etm ;
        // this.paramsList.forEach(item => {
        //   params.displayColumns.push(item)
        // })
        // params.deviceID = this.device.id
        var conts = {
          // "realData": {
          //   "信号强度": {
          //       "2019-08-09 08:50:00": 17.000000,
          //       "2019-08-09 11:25:00": 17.000000,
          //       "2019-08-09 11:50:00": 17.000000,
          //       "2019-08-09 09:30:00": 17.000000,
          //       "2019-08-09 11:35:00": 17.000000,
          //       "2019-08-09 10:15:00": 17.000000,
          //       "2019-08-09 12:20:00": null,
          //       "2019-08-09 11:00:00": 17.000000,
          //       "2019-08-09 10:30:00": 17.000000,
          //       "2019-08-09 10:55:00": 17.000000,
          //       "2019-08-09 09:55:00": 17.000000,
          //       "2019-08-09 12:05:00": 17.000000,
          //       "2019-08-09 10:45:00": 17.000000,
          //       "2019-08-09 10:20:00": 17.000000,
          //       "2019-08-09 11:15:00": 17.000000,
          //       "2019-08-09 11:40:00": 17.000000,
          //       "2019-08-09 08:45:00": 17.000000,
          //       "2019-08-09 09:40:00": 17.000000,
          //       "2019-08-09 10:05:00": 17.000000,
          //       "2019-08-09 12:10:00": 17.000000,
          //       "2019-08-09 09:25:00": 17.000000,
          //       "2019-08-09 12:25:00": null,
          //       "2019-08-09 09:00:00": 17.000000,
          //       "2019-08-09 11:05:00": 17.000000,
          //       "2019-08-09 11:30:00": 17.000000,
          //       "2019-08-09 11:55:00": 17.000000,
          //       "2019-08-09 08:30:00": 16.000000,
          //       "2019-08-09 10:10:00": 17.000000,
          //       "2019-08-09 12:00:00": 17.000000,
          //       "2019-08-09 08:55:00": 17.000000,
          //       "2019-08-09 09:15:00": 17.000000,
          //       "2019-08-09 09:50:00": 17.000000,
          //       "2019-08-09 10:50:00": 17.000000,
          //       "2019-08-09 10:35:00": 17.000000,
          //       "2019-08-09 08:40:00": 16.000000,
          //       "2019-08-09 09:35:00": 17.000000,
          //       "2019-08-09 09:10:00": 17.000000,
          //       "2019-08-09 10:00:00": 17.000000,
          //       "2019-08-09 11:20:00": 17.000000,
          //       "2019-08-09 08:35:00": 16.000000,
          //       "2019-08-09 11:45:00": 17.000000,
          //       "2019-08-09 09:05:00": 17.000000,
          //       "2019-08-09 10:40:00": 17.000000,
          //       "2019-08-09 09:20:00": 17.000000,
          //       "2019-08-09 11:10:00": 17.000000,
          //       "2019-08-09 10:25:00": 17.000000,
          //       "2019-08-09 09:45:00": 17.000000,
          //       "2019-08-09 12:15:00": null
          //   },
          //   "电池电压": {
          //       "2019-08-09 08:50:00": 13.440000,
          //       "2019-08-09 11:25:00": 14.190000,
          //       "2019-08-09 11:50:00": 14.200000,
          //       "2019-08-09 09:30:00": 13.630000,
          //       "2019-08-09 11:35:00": 14.220000,
          //       "2019-08-09 10:15:00": 14.200000,
          //       "2019-08-09 12:20:00": null,
          //       "2019-08-09 11:00:00": 14.200000,
          //       "2019-08-09 10:30:00": 14.200000,
          //       "2019-08-09 10:55:00": 14.170000,
          //       "2019-08-09 09:55:00": 14.070000,
          //       "2019-08-09 12:05:00": 14.220000,
          //       "2019-08-09 10:45:00": 14.170000,
          //       "2019-08-09 10:20:00": 14.200000,
          //       "2019-08-09 11:15:00": 14.200000,
          //       "2019-08-09 11:40:00": 14.220000,
          //       "2019-08-09 08:45:00": 13.420000,
          //       "2019-08-09 09:40:00": 13.460000,
          //       "2019-08-09 10:05:00": 14.200000,
          //       "2019-08-09 12:10:00": 14.150000,
          //       "2019-08-09 09:25:00": 13.530000,
          //       "2019-08-09 12:25:00": null,
          //       "2019-08-09 09:00:00": 13.410000,
          //       "2019-08-09 11:05:00": 14.200000,
          //       "2019-08-09 11:30:00": 14.200000,
          //       "2019-08-09 11:55:00": 14.200000,
          //       "2019-08-09 08:30:00": 13.420000,
          //       "2019-08-09 10:10:00": 14.200000,
          //       "2019-08-09 12:00:00": 14.220000,
          //       "2019-08-09 08:55:00": 13.440000,
          //       "2019-08-09 09:15:00": 13.660000,
          //       "2019-08-09 09:50:00": 14.050000,
          //       "2019-08-09 10:50:00": 14.200000,
          //       "2019-08-09 10:35:00": 14.200000,
          //       "2019-08-09 08:40:00": 13.470000,
          //       "2019-08-09 09:35:00": 13.590000,
          //       "2019-08-09 09:10:00": 13.690000,
          //       "2019-08-09 10:00:00": 14.200000,
          //       "2019-08-09 11:20:00": 14.220000,
          //       "2019-08-09 08:35:00": 13.610000,
          //       "2019-08-09 11:45:00": 14.200000,
          //       "2019-08-09 09:05:00": 13.490000,
          //       "2019-08-09 10:40:00": 14.220000,
          //       "2019-08-09 09:20:00": 13.630000,
          //       "2019-08-09 11:10:00": 14.200000,
          //       "2019-08-09 10:25:00": 14.200000,
          //       "2019-08-09 09:45:00": 13.850000,
          //       "2019-08-09 12:15:00": null
          //   },
          //   "充电电压": {
          //       "2019-08-09 08:50:00": 13.440000,
          //       "2019-08-09 11:25:00": 14.190000,
          //       "2019-08-09 11:50:00": 14.200000,
          //       "2019-08-09 09:30:00": 13.630000,
          //       "2019-08-09 11:35:00": 14.220000,
          //       "2019-08-09 10:15:00": 14.200000,
          //       "2019-08-09 12:20:00": null,
          //       "2019-08-09 11:00:00": 14.200000,
          //       "2019-08-09 10:30:00": 14.200000,
          //       "2019-08-09 10:55:00": 14.170000,
          //       "2019-08-09 09:55:00": 14.070000,
          //       "2019-08-09 12:05:00": 14.220000,
          //       "2019-08-09 10:45:00": 14.170000,
          //       "2019-08-09 10:20:00": 14.200000,
          //       "2019-08-09 11:15:00": 14.200000,
          //       "2019-08-09 11:40:00": 14.220000,
          //       "2019-08-09 08:45:00": 13.420000,
          //       "2019-08-09 09:40:00": 13.460000,
          //       "2019-08-09 10:05:00": 14.200000,
          //       "2019-08-09 12:10:00": 14.150000,
          //       "2019-08-09 09:25:00": 13.530000,
          //       "2019-08-09 12:25:00": null,
          //       "2019-08-09 09:00:00": 13.410000,
          //       "2019-08-09 11:05:00": 14.200000,
          //       "2019-08-09 11:30:00": 14.200000,
          //       "2019-08-09 11:55:00": 14.200000,
          //       "2019-08-09 08:30:00": 13.420000,
          //       "2019-08-09 10:10:00": 14.200000,
          //       "2019-08-09 12:00:00": 14.220000,
          //       "2019-08-09 08:55:00": 13.440000,
          //       "2019-08-09 09:15:00": 13.660000,
          //       "2019-08-09 09:50:00": 14.050000,
          //       "2019-08-09 10:50:00": 14.200000,
          //       "2019-08-09 10:35:00": 14.200000,
          //       "2019-08-09 08:40:00": 13.470000,
          //       "2019-08-09 09:35:00": 13.590000,
          //       "2019-08-09 09:10:00": 13.690000,
          //       "2019-08-09 10:00:00": 14.200000,
          //       "2019-08-09 11:20:00": 14.220000,
          //       "2019-08-09 08:35:00": 13.610000,
          //       "2019-08-09 11:45:00": 14.200000,
          //       "2019-08-09 09:05:00": 13.490000,
          //       "2019-08-09 10:40:00": 14.220000,
          //       "2019-08-09 09:20:00": 13.630000,
          //       "2019-08-09 11:10:00": 14.200000,
          //       "2019-08-09 10:25:00": 14.200000,
          //       "2019-08-09 09:45:00": 13.850000,
          //       "2019-08-09 12:15:00": null
          //   }
          // }
        }
        
        // this.chart.data = conts ? conts : {}
        queryRealDataByCusno(q).then(res=>{
          this.chart.data = res.data ? res.data : {}
          this.chart.key = generateUUID()
        });
      },
    },
    mounted() {
      // this.queryDeviceElement()
    }
  }
</script>


<style lang="scss" rel="stylesheet/scss" type="text/scss">
  @import "~@/styles/variables.scss";

  .site-work {
    display: flex;
    height: 100%;
    flex-direction: column;
    box-shadow: 0px 0px 3px 0px rgba(135, 114, 233, 0.16);
    overflow: hidden;
    min-height: 5.8rem;
    .tab-search {
      padding: 0 0.3rem;
    }
    .tab-chart {
      flex: 1;
      position: relative;
      display: flex;
    }
  }

</style>
